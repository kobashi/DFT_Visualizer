# DFT Visualizer 教材マニュアル

本教材は **p5.js** で動作するインタラクティブ・ビジュアライザーを用いて、
*サンプリング定理*、*ナイキスト周波数*、および *離散フーリエ変換 (DFT) の直交性* を視覚的に学ぶことを目的としています。

---
## 1. 画面構成と UI 操作

| UI 要素 | 説明 |
|---------|------|
| **Trail time (s)** | 回転の残像が消えるまでの時間を 0–5 秒で設定。0 s にすると残像無し。 |
| **Speed (% )** | 針の回転速度倍率 (10–100 %)。DFT 計算も同倍率で追従。 |
| **N (samples)** | DFT ウィンドウ長 (32–512)。2 の冪のみ。 |
| **k (analysis)** | 観測したい DFT 係数の周波数インデックス *kₐ*。 |
| **各アーム行** | <ul><li>色付きボックス: 針の色</li><li>`k` スライダー: 成分の周波数インデックス</li><li>`A` スライダー: 振幅 (0–100 %)</li><li>`φ` スライダー: 位相 (±180°)</li><li>**Solo** ボタン: その成分のみを残し他をミュート</li></ul> |

画面中央には
* 各針（色付き）
* 選択係数 \(C_{kₐ}\)（**紫**）
* その係数で再合成された単一成分（**マゼンタ**）
が描画されます。

---
## 2. サンプリング定理の体験フロー

1. **Speed = 100 %**、**Trail = 0 s**、**N = 128** に設定。
2. 各アームの `k` を 2, 5, 9, 13, 17 とし、`A` は 100 %、`φ` は 0° にする。
3. `k (analysis)` を **2** に合わせる。
   * 紫・マゼンタが赤針と同じ方向・長さになる。
4. `k (analysis)` を **10** など **存在しない周波数** に変える。
   * 紫ベクトルが原点へ縮み、マゼンタ針はほとんど見えなくなる。
   * **→ 直交性により非対応成分の総和は 0** を観察。
5. `N` を **64** へ減らし Nyquist が 32→16 に低下。
   * `k` を 20 以上に設定した針は **エイリアス**して見かけの速度が変化。
6. `Trail` を 1–2 s に上げ残像を表示し、折り返した軌跡が確認できる。

---
## 3. ナイキスト周波数とエイリアシングの確認手順

| 手順 | 操作 | 期待される視覚効果 |
|------|------|------------------|
| 1 | `N = 64` (Nyquist = 32) | Nyquist 値が左上に表示される |
| 2 | アーム 1 の `k` を 40 に変更 | 赤針の実速度は 40/64 周期だが、画面では **折返し 24** 周期として遅く・逆向きに見える |
| 3 | `k (analysis)` を 40 に設定 | 紫ベクトルは **0** に近くなる (高域成分を正しく検出できない) |
| 4 | `k (analysis)` を 24 に設定 | 紫ベクトルが赤針と一致し、エイリアス後の周波数で検出される |

> **ポイント**: Nyquist 頻度を超える成分は低域へ折り返し、DFT でも別の *k* に現れることを視覚的に示す。

---
## 4. DFT 直交性の理解ステップ

1. Solo を OFF にして **すべての成分を合成**。
2. `k (analysis)` を 1 ずつ変えながら紫ベクトルの長さを観察。
   * *k* が **2, 5, 9, 13, 17** のときのみ |C_k| が大きく、他では 0 に近い。
3. **Trail** を 0 s にし、**Speed** を下げてゆっくり回転させると、
   非対応周波数では紫ベクトルがほぼ原点でノイズ的に揺れるだけになる。

これにより “DFT は同じ周波数成分だけを抽出し、他成分は総和が 0 で打ち消し合う” ことが視覚的に体験できます。

---
## 5. 発展課題

- **ウィンドウ関数**: 長方形窓以外（ハニング等）を乗算し、*k = 2.5* など非整数を観察して漏れを比較。
- **複数アームで同一 k**: 振幅・位相を変えて加算結果を検証。
- **Amplitude＝0** の針を使って位相だけが影響しないことを確認。

---
## 6. まとめ

本ビジュアライザーを操作することで、以下を直感的に習得できます。

1. **サンプリング定理**: 取得サンプル数 *N* が周波数分解能と Nyquist に直結。
2. **エイリアシング**: Nyquist 超の成分は折り返して誤認される。
3. **DFT の直交性** & **ベクトル和のキャンセル**: 対応する周波数以外の係数は 0 (≒ 0) になる。

授業や自学自習の補助にご活用ください。
